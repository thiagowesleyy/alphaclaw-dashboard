<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlphaClaw Quant v3 â€” Painel</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;scrollbar-width:thin;scrollbar-color:#1a2e42 #010913}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#1a2e42;border-radius:2px}
body{background:#010913;color:#B8CCD8;font-family:'Courier New',monospace;font-size:12px;overflow-x:hidden}
@keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.sp{display:inline-block;animation:spin 1s linear infinite}
.dot{width:6px;height:6px;border-radius:50%;animation:pulse 2s infinite;display:inline-block;flex-shrink:0}
.tag{font-size:9px;padding:2px 6px;border-radius:3px;font-weight:700;letter-spacing:.5px;font-family:monospace;white-space:nowrap}
button{cursor:pointer;font-family:monospace;border:none;outline:none;transition:opacity .15s}
button:hover{opacity:.8}
.card{background:#050e1c;border:1px solid #0d1e30;border-radius:8px;padding:14px}
.cdark{background:#020c18;border:1px solid #071422;border-radius:6px;padding:10px}
.lbl{font-size:8px;color:#2a4060;margin-bottom:4px;letter-spacing:.5px;text-transform:uppercase}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.g4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}
.green{color:#00FF88}.red{color:#FF4455}.yel{color:#FFB800}.gray{color:#8899AA}.blue{color:#00AAFF}
#hdr{background:linear-gradient(90deg,#010913,#031528,#010913);border-bottom:1px solid #0a1f35;padding:10px 18px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
#tkw{overflow:hidden;border-bottom:1px solid #071422;height:26px;display:flex;align-items:center;background:#010913}
#tki{display:flex;gap:32px;animation:ticker 90s linear infinite;white-space:nowrap;padding-left:20px}
#tabs{background:#010913;border-bottom:1px solid #071422;padding:0 18px;display:flex;overflow-x:auto}
#tabs button{background:none;padding:9px 14px;font-size:10px;text-transform:uppercase;letter-spacing:1px;white-space:nowrap;border-bottom:2px solid transparent;color:#2a4060}
#tabs button.act{color:#00FF88;border-bottom:2px solid #00FF88}
#dg{display:grid;grid-template-columns:235px 1fr 258px;height:calc(100vh - 132px);overflow:hidden}
#cl{border-right:1px solid #071422;overflow-y:auto;padding:8px}
#cp{overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
#np{border-left:1px solid #071422;overflow-y:auto;display:flex;flex-direction:column}
.ci{padding:8px 10px;border-radius:6px;cursor:pointer;margin-bottom:3px;border:1px solid #071422;transition:all .15s}
.ci:hover{background:#0a1e3520}
.tr{display:grid;padding:9px 14px;border-bottom:1px solid #071422;font-family:monospace;font-size:10px;align-items:center}
.th{background:#020c18;font-size:8px;color:#2a4060;text-transform:uppercase;letter-spacing:.5px}
.ni{padding:7px 12px;border-bottom:1px solid #080f1a;cursor:pointer}
.ni:hover{background:#0a1e3515}
.nb{background:#120800!important}
.tc{display:none;padding:14px;animation:fadeIn .3s ease}
.tc.act{display:block}

/* OTIMIZAÃ‡ÃƒO PARA SMARTPHONES E TABLETS */
@media (max-width: 768px) {
  #dg { display: flex !important; flex-direction: column !important; height: auto !important; overflow: visible !important; }
  #cl { border-right: none !important; border-bottom: 1px solid #071422 !important; max-height: 250px !important; }
  #cp { overflow-y: visible !important; }
  #np { border-left: none !important; border-top: 1px solid #071422 !important; height: 400px !important; }
  #hdr { flex-direction: column; align-items: flex-start; gap: 12px; }
  #tabs { padding-bottom: 5px; }
  .g3, .g4 { grid-template-columns: 1fr 1fr !important; }
}
</style>
</head>
<body>

<div id="hdr">
  <div style="display:flex;align-items:center;gap:12px">
    <div style="width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,#00FF88,#00AAFF);display:flex;align-items:center;justify-content:center;font-size:20px">âš¡</div>
    <div>
      <div style="font-size:16px;font-weight:700;color:#E0F0FF;letter-spacing:2px">ALPHACLAW <span class="green">v3</span></div>
      <div style="font-size:8px;color:#2a4060;letter-spacing:1px">INTELIGÃŠNCIA CRIPTO Â· DADOS AO VIVO Â· BYBIT</div>
    </div>
  </div>
  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
    <div id="stp" style="display:flex;align-items:center;gap:4px;padding:3px 8px;border-radius:4px;background:#FFB80008;border:1px solid #FFB80025"><div class="dot" style="background:#FFB800"></div><span style="font-size:8px;color:#FFB800">PREÃ‡OS...</span></div>
    <div id="stn" style="display:flex;align-items:center;gap:4px;padding:3px 8px;border-radius:4px;background:#FFB80008;border:1px solid #FFB80025"><div class="dot" style="background:#FFB800"></div><span style="font-size:8px;color:#FFB800">NOTÃCIAS...</span></div>
    <div id="stb" style="display:flex;align-items:center;gap:4px;padding:3px 8px;border-radius:4px;background:#FF445508;border:1px solid #FF445525;cursor:pointer" onclick="togD()"><div class="dot" style="background:#FF4455"></div><span style="font-size:8px;color:#FF4455">BOT OFFLINE</span></div>
    <div id="rgb" style="text-align:center;padding:4px 10px;border-radius:5px;background:#8899AA15;border:1px solid #8899AA33"><div class="lbl">REGIME</div><div id="rgv" style="font-size:10px;font-weight:700;color:#8899AA">NEUTRAL</div></div>
    <div style="text-align:center"><div class="lbl">MEDO E GANÃ‚NCIA</div><div id="fgv" style="font-size:13px;font-weight:700;color:#FFB800">50</div></div>
    
    <div style="text-align:center"><div class="lbl">SALDO PAPER</div><div id="blv" style="font-size:12px;font-weight:700;color:#00FF88">$10,000</div></div>
    
    <div id="live-pnl-box" style="text-align:center;padding:4px 12px;border-radius:5px;background:#FFB80015;border:1px solid #FFB800;box-shadow: 0 0 10px #FFB80040;transition:all 0.3s">
      <div class="lbl" id="live-pnl-lbl" style="color:#FFB800;font-weight:700;letter-spacing:1px">LUCRO AO VIVO</div>
      <div id="live-pnl-val" style="font-size:14px;font-weight:700;color:#FFB800">$0.00 <span style="font-size:10px">(0.00%)</span></div>
    </div>

    <div style="text-align:center"><div class="lbl">CICLO</div><div id="cyv" style="font-size:11px;color:#2a4060">â€”</div></div>
  </div>
</div>

<div id="dg-panel" style="display:none;background:#050e1c;border-bottom:1px solid #0d1e30;padding:12px 18px">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
    <div class="cdark"><div class="lbl" style="margin-bottom:8px">STATUS</div><div id="dchk"></div></div>
    <div class="cdark"><div class="lbl" style="margin-bottom:8px">COMO CONECTAR O BOT</div>
      <div style="font-size:9px;color:#8899AA;line-height:2">
        1. Abra este arquivo no editor<br>
        2. Linha 2: substitua <code style="background:#010913;padding:1px 4px;border-radius:2px;color:#00AAFF">BOT_API</code> pela URL do seu bot Railway<br>
        3. Salve e faÃ§a upload no GitHub â†’ Railway faz redeploy
      </div>
    </div>
  </div>
  <div class="cdark" style="margin-top:10px;max-height:80px;overflow-y:auto"><div id="dlg" style="font-size:9px;color:#2a4060;font-family:monospace"></div></div>
</div>

<div id="tkw"><div id="tki"><span style="color:#2a4060"><span class="sp">âŸ³</span> Carregando preÃ§os ao vivo...</span></div></div>

<div id="tabs">
  <button class="act" onclick="ST('dash')">Painel</button>
  <button onclick="ST('preco')">PreÃ§os</button>
  <button onclick="ST('sinal')">âš¡ Sinais <span id="bsg" style="display:none;font-size:7px;background:#00FF8820;color:#00FF88;padding:1px 4px;border-radius:2px;margin-left:3px"></span></button>
  <button onclick="ST('posic')">PosiÃ§Ãµes <span id="bpg" style="display:none;font-size:7px;background:#00AAFF20;color:#00AAFF;padding:1px 4px;border-radius:2px;margin-left:3px"></span></button>
  <button onclick="ST('notic')">NotÃ­cias <span id="bbg" style="display:none;font-size:7px;background:#FF445520;color:#FF4455;padding:1px 4px;border-radius:2px;margin-left:3px"></span></button>
  <button onclick="ST('trade')">HistÃ³rico & P&L</button>
  <button onclick="ST('logs')">Logs do Bot</button>
  <button onclick="ST('sobre')">Sobre</button>
</div>

<div id="tab-dash" style="display:block">
  <div id="dg">
    <div id="cl"><div style="font-size:8px;color:#1a2e42;padding:2px 6px 6px;letter-spacing:1px">TOP 10</div><div id="cli"></div></div>
    <div id="cp">
      <div class="card" id="mc"><div style="color:#2a4060"><span class="sp">âŸ³</span> Carregando...</div></div>
      <div class="card" id="sc" style="display:none"></div>
      <div class="card"><div class="lbl">VARIAÃ‡ÃƒO 24H</div><canvas id="bc" height="120"></canvas></div>
     <div class="card"><div class="lbl" style="margin-bottom:8px">MERCADO</div><div class="g3" id="mg"></div></div>
      
      <div id="dash-pos" style="display:none; margin-top:10px"></div>
      <div id="dash-trades" style="display:none; margin-top:10px"></div>
      
    </div>
    <div id="np">
      <div style="padding:8px 12px;border-bottom:1px solid #071422;background:#010913;position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center">
        <span style="font-size:9px;color:#2a4060;letter-spacing:1px">ğŸ“° NOTÃCIAS</span>
        <div style="display:flex;gap:3px">
          <button onclick="SNF('ALL')" data-f="ALL" class="nfb" style="background:#00FF8818;border:1px solid #00FF8844;color:#00FF88;font-size:7px;padding:2px 4px;border-radius:3px">TUDO</button>
          <button onclick="SNF('BTC')" data-f="BTC" class="nfb" style="background:none;border:1px solid #071422;color:#2a4060;font-size:7px;padding:2px 4px;border-radius:3px">BTC</button>
          <button onclick="SNF('ETH')" data-f="ETH" class="nfb" style="background:none;border:1px solid #071422;color:#2a4060;font-size:7px;padding:2px 4px;border-radius:3px">ETH</button>
          <button onclick="SNF('SOL')" data-f="SOL" class="nfb" style="background:none;border:1px solid #071422;color:#2a4060;font-size:7px;padding:2px 4px;border-radius:3px">SOL</button>
          <button onclick="SNF('XRP')" data-f="XRP" class="nfb" style="background:none;border:1px solid #071422;color:#2a4060;font-size:7px;padding:2px 4px;border-radius:3px">XRP</button>
        </div>
      </div>
      <div id="nsb"><div style="padding:20px;text-align:center;color:#2a4060;font-size:10px"><span class="sp">âŸ³</span></div></div>
    </div>
  </div>
</div>

<div id="tab-preco" class="tc">
  <div class="card" style="overflow:hidden">
    <div class="tr th" style="grid-template-columns:30px 100px 110px 70px 75px 75px 90px 90px 75px;gap:8px">
      <span>#</span><span>Ativo</span><span>PreÃ§o</span><span>1h</span><span>24h</span><span>7d</span><span>Vol 24h</span><span>Cap. Mercado</span><span>ATH %</span>
    </div>
    <div id="ptbl"></div>
  </div>
</div>

<div id="tab-sinal" class="tc">
  <div id="sof" style="background:#0a0500;border:1px solid #FF880020;border-radius:8px;padding:18px;margin-bottom:14px;text-align:center;color:#FF8800;font-size:11px;line-height:2">
    âš¡ Bot Railway offline<br><span style="font-size:9px;color:#4a3010">Configure o BOT_API neste arquivo com a URL do seu bot Railway</span>
  </div>
  <div id="son" style="display:none">
    <div class="g4" style="margin-bottom:14px" id="sstats"></div>
    <div class="card" style="overflow:hidden">
      <div id="stbl"></div>
    </div>
  </div>
</div>

<div id="tab-posic" class="tc">
  <div class="g3" style="margin-bottom:14px" id="pstats"></div>
  <div id="pcnt"></div>
</div>

<div id="tab-notic" class="tc">
  <div class="g4" style="margin-bottom:14px" id="nstats"></div>
  <div class="card" style="overflow:hidden">
    <div style="padding:8px 14px;border-bottom:1px solid #071422;display:flex;justify-content:space-between;align-items:center">
      <span id="nlbl" style="font-size:9px;color:#2a4060">CARREGANDO...</span>
      <div style="display:flex;gap:4px">
        <button onclick="SNF2('ALL')" class="nf2" style="background:#00FF8818;border:1px solid #00FF8844;color:#00FF88;font-size:8px;padding:2px 6px;border-radius:3px">TUDO</button>
        <button onclick="SNF2('BTC')" class="nf2" style="background:none;border:1px solid #071422;color:#2a4060;font-size:8px;padding:2px 6px;border-radius:3px">BTC</button>
        <button onclick="SNF2('ETH')" class="nf2" style="background:none;border:1px solid #071422;color:#2a4060;font-size:8px;padding:2px 6px;border-radius:3px">ETH</button>
        <button onclick="SNF2('XRP')" class="nf2" style="background:none;border:1px solid #071422;color:#2a4060;font-size:8px;padding:2px 6px;border-radius:3px">XRP</button>
        <button onclick="SNF2('SOL')" class="nf2" style="background:none;border:1px solid #071422;color:#2a4060;font-size:8px;padding:2px 6px;border-radius:3px">SOL</button>
        <button onclick="SNF2('BNB')" class="nf2" style="background:none;border:1px solid #071422;color:#2a4060;font-size:8px;padding:2px 6px;border-radius:3px">BNB</button>
      </div>
    </div>
    <div id="nfl"></div>
  </div>
</div>

<div id="tab-trade" class="tc">
  <div class="g4" style="margin-bottom:14px" id="tstats"></div>
  <div id="tcnt"></div>
</div>

<div id="tab-logs" class="tc">
  <div class="card" style="max-height:78vh;overflow-y:auto">
    <div style="font-size:9px;color:#2a4060;margin-bottom:10px;border-bottom:1px solid #071422;padding-bottom:8px;display:flex;justify-content:space-between">
      <span>LOG DO BOT AO VIVO</span><span id="lst" style="font-size:8px;color:#1a2e42">atualiza a cada 15s</span>
    </div>
    <div id="lcnt"><div style="text-align:center;padding:30px;color:#2a4060">Aguardando conexÃ£o com o bot...</div></div>
  </div>
</div>

<div id="tab-sobre" class="tc">
  <div style="max-width:800px; margin:0 auto; background:#030e1a; border:1px solid #071422; border-radius:8px; padding:32px; box-shadow:0 4px 20px rgba(0,0,0,0.5)">
    <h1 style="font-size:24px; color:#00FF88; margin-bottom:8px; margin-top:0; letter-spacing:1px">AlphaClaw Quant v3.0</h1>
    <p style="color:#8899AA; font-size:14px; line-height:1.7; margin-bottom:32px">
      O AlphaClaw Quant Ã© um ecossistema de negociaÃ§Ã£o algorÃ­tmica de nÃ­vel institucional, concebido para operar com a precisÃ£o e a gestÃ£o de risco de um fundo de investimento profissional. Ele transcende a automaÃ§Ã£o tradicional ao fundir anÃ¡lises matemÃ¡ticas complexas com uma poderosa InteligÃªncia Artificial de raciocÃ­nio profundo. O sistema nÃ£o apenas identifica padrÃµes grÃ¡ficos, mas compreende o contexto macroeconÃ´mico, garantindo que o capital seja exposto apenas nos cenÃ¡rios de mais alta probabilidade e seguranÃ§a.
    </p>

    <h2 style="font-size:13px; color:#E0F0FF; border-bottom:1px solid #071422; padding-bottom:8px; margin-bottom:16px; letter-spacing:2px">âš™ï¸ CAPACIDADES PRINCIPAIS (O MOTOR)</h2>
    <ul style="color:#B8CCD8; font-size:13px; line-height:2.0; margin-bottom:40px; padding-left:20px">
      <li><strong style="color:#00AAFF">Matriz de MÃºltiplos PerÃ­odos (MTF):</strong> Analisa o mercado em diversas janelas de tempo simultaneamente (desde os 15 minutos atÃ© o grÃ¡fico diÃ¡rio) para encontrar entradas cirÃºrgicas alinhadas com a tendÃªncia principal.</li>
      <li><strong style="color:#FF4455">Detector de Regime de Mercado (ADX):</strong> Adapta-se dinamicamente ao comportamento do mercado. Desativa estratÃ©gias de reversÃ£o durante tendÃªncias fortes e bloqueia rompimentos falsos em mercados laterais.</li>
      <li><strong style="color:#00FF88">ExecuÃ§Ã£o Otimizada (Zero-Fee):</strong> Utiliza ordens passivas (Post-Only) para fornecer liquidez ao livro de ofertas, eliminando os custos das taxas de execuÃ§Ã£o da corretora e maximizando o lucro lÃ­quido.</li>
      <li><strong style="color:#FFB800">ProteÃ§Ã£o DinÃ¢mica (Trailing Stop):</strong> Um gestor de risco implacÃ¡vel. Assim que uma operaÃ§Ã£o atinge uma margem de lucro segura, o sistema move a proteÃ§Ã£o automaticamente, garantindo lucros e eliminando o risco de perda.</li>
      <li><strong style="color:#9945FF">Motor de ConfluÃªncia:</strong> O algoritmo atua como um comitÃª de decisÃµes. Uma operaÃ§Ã£o sÃ³ Ã© ativada se mÃºltiplas estratÃ©gias tÃ©cnicas concordarem no mesmo exato milissegundo.</li>
    </ul>

    <h2 style="font-size:13px; color:#E0F0FF; border-bottom:1px solid #071422; padding-bottom:8px; margin-bottom:16px; letter-spacing:2px">ğŸš€ ÃšLTIMAS ATUALIZAÃ‡Ã•ES</h2>
    <div style="display:flex; flex-direction:column; gap:14px">
      <div style="background:#0a1525; padding:16px; border-radius:6px; border-left:4px solid #00FF88">
        <div style="font-size:12px; color:#00FF88; margin-bottom:6px; font-weight:bold; letter-spacing:1px">v3.0 â€” Agente Validador de InteligÃªncia Artificial</div>
        <div style="font-size:12px; color:#8899AA; line-height:1.6">IntegraÃ§Ã£o de ponta com IA Generativa. Antes de enviar qualquer ordem, o CÃ©rebro de IA analisa o Sentimento Global (Ãndice de Medo e GanÃ¢ncia) e o impacto das Ãºltimas notÃ­cias em tempo real. Se o cenÃ¡rio apresentar risco sistÃªmico, a IA atua como um "Gestor SÃªnior" e possui autoridade para vetar a operaÃ§Ã£o, protegendo a sua banca de quedas repentinas.</div>
      </div>
      <div style="background:#0a1525; padding:16px; border-radius:6px; border-left:4px solid #00AAFF">
        <div style="font-size:12px; color:#00AAFF; margin-bottom:6px; font-weight:bold; letter-spacing:1px">v2.8 â€” Rastreador de LiquidaÃ§Ãµes (Squeeze Detector)</div>
        <div style="font-size:12px; color:#8899AA; line-height:1.6">MÃ³dulo especializado em monitorar picos anormais de volume. A estratÃ©gia lucra em momentos de pÃ¢nico, entrando a favor da tendÃªncia quando traders superalavancados sÃ£o liquidados pelas corretoras.</div>
      </div>
    </div>
    
    <div style="margin-top:40px; text-align:center; font-size:10px; color:#3a5070; border-top:1px solid #071422; padding-top:20px; letter-spacing:1px">
      DESENVOLVIDO PARA ALTA PERFORMANCE | AUTOMAÃ‡ÃƒO TOTAL VIA GITHUB & RAILWAY
    </div>
  </div>
</div>

<div style="border-top:1px solid #071422;padding:5px 18px;display:flex;justify-content:space-between;font-size:8px;color:#1a2e42">
  <span>AlphaClaw v3 Â· CoinGecko Â· CryptoCompare Â· Alternative.me Â· Railway Bot</span>
  <span id="ftm"></span>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  âš™ï¸  TROQUE PELA URL DO SEU BOT NO RAILWAY
//  Ex: https://alphaclaw-bot-production.up.railway.app
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BOT_API = "https://alphaclaw-bot-production.up.railway.app";

const CLR={BTC:"#F7931A",ETH:"#627EEA",BNB:"#F3BA2F",XRP:"#346AA9",SOL:"#9945FF",ADA:"#0033AD",DOGE:"#C2A633",AVAX:"#E84142",DOT:"#E6007A",LINK:"#2A5ADA"};
const IDS={BTC:"bitcoin",ETH:"ethereum",BNB:"binancecoin",XRP:"ripple",SOL:"solana",ADA:"cardano",DOGE:"dogecoin",AVAX:"avalanche-2",DOT:"polkadot",LINK:"chainlink"};
const SYM=Object.keys(CLR);

let P={},AN=[],BS={},BP=[],BT={trades:[],stats:{}},BL=[],BH=null,BM={};
let SC="BTC",NF="ALL",NF2="ALL",BON=false,fg={value:50,classification:"Neutral"};

const fP=n=>!n?"â€”":n>=1000?"$"+n.toLocaleString("en",{maximumFractionDigits:2}):n>=1?"$"+n.toFixed(4):"$"+n.toFixed(6);
const fB=n=>!n?"â€”":n>=1e9?"$"+(n/1e9).toFixed(2)+"B":n>=1e6?"$"+(n/1e6).toFixed(2)+"M":"$"+n.toFixed(0);
const pc=n=>(n>=0?"+":"")+((n||0).toFixed(2))+"%";
const gc=n=>n>=0?"#00FF88":"#FF4455";
const sC=s=>s==="LONG"?"#00FF88":s==="SHORT"?"#FF4455":"#FFB800";
const sBg=s=>s==="LONG"?"#00FF8815":s==="SHORT"?"#FF445515":"#FFB80015";
const tg=(t,c,bg)=>`<span class="tag" style="color:${c};background:${bg||c+"18"}">${t}</span>`;
const DL=m=>{const e=document.getElementById("dlg");if(e)e.innerHTML=`<div>${new Date().toLocaleTimeString("pt-BR")} â€” ${m}</div>`+e.innerHTML;};

function setST(id,ok,msg){
  const e=document.getElementById(id),c=ok?"#00FF88":"#FF4455",bg=ok?"#00FF8808":"#FF445508",br=ok?"#00FF8825":"#FF445525";
  e.style.background=bg;e.style.border="1px solid "+br;
  e.innerHTML=`<div class="dot" style="background:${c}"></div><span style="font-size:8px;color:${c}">${msg}</span>`;
}

let diagOpen=false;
function togD(){diagOpen=!diagOpen;document.getElementById("dg-panel").style.display=diagOpen?"block":"none";RD();}
function RD(){
  document.getElementById("dchk").innerHTML=[
    [Object.keys(P).length>0,"PreÃ§os CoinGecko"],
    [AN.length>0,"NotÃ­cias CryptoCompare"],
    [BON,"Bot Railway conectado"],
    [BON&&Object.keys(BS).length>0,"Sinais recebidos"],
    [BON&&BP!==undefined,"PosiÃ§Ãµes sincronizadas"],
  ].map(([ok,l])=>`<div style="font-size:10px;color:${ok?"#00FF88":"#FF4455"};margin-bottom:3px">${ok?"âœ…":"âŒ"} ${l}</div>`).join("");
}

// â”€â”€ LISTA DE ABAS ATUALIZADA (ADICIONADO "SOBRE") â”€â”€
const TABS=["dash","preco","sinal","posic","notic","trade","logs","sobre"];
function ST(n){
  document.getElementById("tab-dash").style.display=n==="dash"?"block":"none";
  TABS.filter(t=>t!=="dash").forEach(t=>{const e=document.getElementById("tab-"+t);if(e){e.classList.toggle("act",t===n);}});
  document.querySelectorAll("#tabs button").forEach((b,i)=>b.classList.toggle("act",TABS[i]===n));
  if(n==="notic")RFN();if(n==="trade")RTR();if(n==="logs")RLG();if(n==="posic")RPS();if(n==="sinal")RSG();
}

// â”€â”€ FETCH PREÃ‡OS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function FP(){
  try{
    const r=await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${Object.values(IDS).join(",")}&price_change_percentage=1h,24h,7d&sparkline=true`);
    if(!r.ok)throw new Error("HTTP "+r.status);
    (await r.json()).forEach(c=>{
      const s=Object.keys(IDS).find(k=>IDS[k]===c.id);
      if(s)P[s]={price:c.current_price,c1:c.price_change_percentage_1h_in_currency||0,c24:c.price_change_percentage_24h_in_currency||0,c7:c.price_change_percentage_7d_in_currency||0,hi:c.high_24h,lo:c.low_24h,vol:c.total_volume,mc:c.market_cap,rk:c.market_cap_rank,ath:c.ath,athC:c.ath_change_percentage,sp:(c.sparkline_in_7d?.price||[]).filter((_,i,a)=>i%Math.floor(a.length/24)===0).slice(-24)};
    });
    setST("stp",true,"PREÃ‡OS AO VIVO âœ“");
    RA();
  }catch(e){setST("stp",false,"ERRO COINGECKO");DL("âŒ CoinGecko: "+e.message);}
}

// â”€â”€ FETCH F&G â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function FFG(){
  try{
    const d=await fetch("https://api.alternative.me/fng/?limit=1").then(r=>r.json());
    if(d.data?.[0]){fg={value:+d.data[0].value,classification:d.data[0].value_classification};}
    const v=fg.value,c=v<25?"#FF4455":v<45?"#FF8800":v>75?"#FF4455":v>55?"#00FF88":"#FFB800";
    document.getElementById("fgv").innerHTML=`<span style="color:${c}">${v}</span> <span style="font-size:8px;color:#4a6060">${fg.classification}</span>`;
  }catch{}
}

// â”€â”€ FETCH NOTÃCIAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function FN(){
  try{
    const r=await fetch("https://min-api.cryptocompare.com/data/v2/news/?lang=EN&sortOrder=latest&limit=40");
    if(!r.ok)throw new Error("HTTP "+r.status);
    const d=await r.json();
    AN=(d.Data||[]).map(n=>{
      const t=n.title.toLowerCase();
      const coin=["btc","bitcoin"].some(x=>t.includes(x))?"BTC":["eth","ethereum"].some(x=>t.includes(x))?"ETH":["xrp","ripple"].some(x=>t.includes(x))?"XRP":["sol","solana"].some(x=>t.includes(x))?"SOL":["bnb","binance"].some(x=>t.includes(x))?"BNB":["ada","cardano"].some(x=>t.includes(x))?"ADA":["doge","dogecoin"].some(x=>t.includes(x))?"DOGE":["avax","avalanche"].some(x=>t.includes(x))?"AVAX":["dot","polkadot"].some(x=>t.includes(x))?"DOT":["link","chainlink"].some(x=>t.includes(x))?"LINK":"CRIPTO";
      const cats=(n.categories||"").toLowerCase();
      const reg=cats.includes("regulation")||t.includes("sec")||t.includes("ban");
      const bull=t.includes("surge")||t.includes("rally")||t.includes("bull")||t.includes("ath")||t.includes("approve")||t.includes("soar");
      const bear=t.includes("crash")||t.includes("hack")||t.includes("scam")||t.includes("collapse")||t.includes("plunge");
      const imp=reg?(bull?7:bear?-7:2):bull?4:bear?-4:(Math.random()*2-.5);
      const brk=Math.abs(imp)>=6||n.title.includes("BREAKING");
      const age=Date.now()/1000-n.published_on;
      const ts=age<3600?Math.floor(age/60)+"m atrÃ¡s":age<86400?Math.floor(age/3600)+"h atrÃ¡s":Math.floor(age/86400)+"d atrÃ¡s";
      return{title:n.title,source:n.source_info?.name||n.source,url:n.url,coin,imp:+imp.toFixed(1),time:ts,brk,cat:reg?"REGULATÃ“RIO":cats.includes("market")?"MERCADO":"GERAL"};
    });
    const brk=AN.filter(n=>n.brk).length;
    const bb=document.getElementById("bbg");if(brk>0){bb.style.display="inline";bb.textContent=brk+" ğŸ”´";}
    setST("stn",true,AN.length+" NOTÃCIAS âœ“");
    RNS();
  }catch(e){setST("stn",false,"ERRO NOTÃCIAS");DL("âŒ NotÃ­cias: "+e.message);}
}

// â”€â”€ FETCH BOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function FB(){
  try{
    const h=await fetch(BOT_API+"/health",{signal:AbortSignal.timeout(5000)}).then(r=>r.ok?r.json():null).catch(()=>null);
    if(!h){BON=false;setST("stb",false,"BOT OFFLINE");document.getElementById("cyv").textContent="â€”";DL("âŒ Bot offline â€” "+BOT_API);return;}
    BON=true;BH=h;
    setST("stb",true,"BOT ONLINE Â· Ciclo #"+h.cycle);
    document.getElementById("cyv").textContent="#"+h.cycle;
    DL("âœ… Bot conectado â€” Ciclo #"+h.cycle);
    const [s,pos,m,t,l]=await Promise.all([
      fetch(BOT_API+"/signals").then(r=>r.json()).catch(()=>({signals:[]})),
      fetch(BOT_API+"/positions").then(r=>r.json()).catch(()=>({positions:[],balance:10000})),
      fetch(BOT_API+"/market").then(r=>r.json()).catch(()=>({})),
      fetch(BOT_API+"/trades?limit=30").then(r=>r.json()).catch(()=>({trades:[],stats:{}})),
      fetch(BOT_API+"/logs?limit=80").then(r=>r.json()).catch(()=>({logs:[]})),
    ]);
    BS={};(s.signals||[]).forEach(x=>{BS[x.symbol?.replace("/USDT","")]=x;});
    BP=pos.positions||[];BM=m;BT=t;BL=[...(l.logs||[])].reverse();
    if(m.balance)document.getElementById("blv").textContent="$"+m.balance.toLocaleString("en",{maximumFractionDigits:2});
    const reg=m.regime||"NEUTRAL",rc={CAPITULATION:"#FF4455",FEAR:"#FF8800",EUPHORIA:"#FF4455",GREED:"#FFB800",NEUTRAL:"#8899AA",OPTIMISM:"#00FF88"}[reg]||"#8899AA";
    document.getElementById("rgv").textContent=reg;document.getElementById("rgv").style.color=rc;
    document.getElementById("rgb").style.background=rc+"15";document.getElementById("rgb").style.border="1px solid "+rc+"33";
    const ls=Object.values(BS).filter(s=>s.signal==="LONG").length,ss=Object.values(BS).filter(s=>s.signal==="SHORT").length;
    const bs=document.getElementById("bsg");if(ls+ss>0){bs.style.display="inline";bs.textContent=ls+"L "+ss+"S";}
    const bp=document.getElementById("bpg");if(BP.length>0){bp.style.display="inline";bp.textContent=BP.length;}
    RMC();RCL();RDashExtras();RLivePnL();
  }catch(e){BON=false;setST("stb",false,"BOT OFFLINE");DL("âŒ Erro: "+e.message);}
}

// â”€â”€ RENDER COIN LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RCL(){
  document.getElementById("cli").innerHTML=SYM.map(s=>{
    const p=P[s]||{},b=BS[s]||{},c=CLR[s],act=s===SC;
    const chg=p.c24||0;
    return `<div class="ci" style="border-color:${act?c+"44":"#071422"};background:${act?"linear-gradient(135deg,#0a1e35,#071525)":"transparent"}" onclick="SC='${s}';RA()">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;align-items:center;gap:5px"><div style="width:7px;height:7px;border-radius:50%;background:${c}"></div><span style="font-weight:700;color:#D0E0F0">${s}</span>${p.rk?`<span style="font-size:7px;color:#1a2e42">#${p.rk}</span>`:""}</div>
        ${b.signal?tg(b.signal,sC(b.signal),sBg(b.signal)):`<span style="font-size:9px;color:#1a2e42">â€”</span>`}
      </div>
      <div style="display:flex;justify-content:space-between;margin-top:3px;align-items:center">
        <span style="font-size:12px;font-family:monospace;font-weight:700;color:#E8F4FF">${p.price?fP(p.price):'<span style="color:#1a2e42;font-size:9px">â€¦</span>'}</span>
        <span style="font-size:10px;color:${gc(chg)};font-weight:700">${pc(chg)}</span>
      </div>
      ${b.signal&&b.signal!=="NEUTRAL"?`<div style="margin-top:3px"><div style="height:2px;background:#0a1828;border-radius:1px"><div style="height:100%;width:${b.confidence||0}%;background:${sC(b.signal)};border-radius:1px"></div></div><div style="font-size:7px;color:#2a4060;margin-top:1px">${b.strategy_count||0} strats Â· ${(b.confidence||0).toFixed(0)}%</div></div>`:""}
    </div>`;
  }).join("");
}

// â”€â”€ RENDER MAIN CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RMC(){
  const s=SC,p=P[s]||{},b=BS[s]||{},c=CLR[s],e=document.getElementById("mc");
  if(!p.price){e.innerHTML=`<div style="color:#2a4060"><span class="sp">âŸ³</span> Carregando ${s}...</div>`;return;}
  e.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <div style="width:12px;height:12px;border-radius:50%;background:${c}"></div>
          <span style="font-size:20px;font-weight:700;color:#E8F4FF">${s}/USDT</span>
          ${p.rk?tg("#"+p.rk,"#4a6080"):""}
        </div>
        <div style="font-size:34px;font-weight:700;font-family:monospace;color:#F0F8FF">${fP(p.price)}</div>
        <div style="display:flex;gap:16px;margin-top:4px;font-size:11px">
          <span style="color:${gc(p.c1)}">1h: ${pc(p.c1)}</span>
          <span style="color:${gc(p.c24)};font-weight:700">24h: ${pc(p.c24)}</span>
          <span style="color:${gc(p.c7)}">7d: ${pc(p.c7)}</span>
        </div>
        <div style="display:flex;gap:14px;margin-top:8px;font-size:10px;color:#2a4060">
          <span>MÃ¡x: <span class="green">${fP(p.hi)}</span></span>
          <span>MÃ­n: <span class="red">${fP(p.lo)}</span></span>
          <span>Vol: <span class="gray">${fB(p.vol)}</span></span>
          <span>Cap. Mercado: <span class="gray">${fB(p.mc)}</span></span>
        </div>
        <div style="margin-top:4px;font-size:10px;color:#2a4060">ATH: <span class="gray">${fP(p.ath)}</span> <span class="red">${(p.athC||0).toFixed(1)}%</span></div>
      </div>
      <div style="text-align:center;min-width:130px">
        <div style="padding:10px 16px;border-radius:8px;background:${sBg(b.signal||"NEUTRAL")};border:2px solid ${sC(b.signal||"NEUTRAL")}44;color:${sC(b.signal||"NEUTRAL")};font-size:20px;font-weight:700;letter-spacing:2px;margin-bottom:6px">${b.signal||"â€”"}</div>
        ${BON?`<div style="font-size:9px;color:#2a4060">${b.strategy_count||0} estratÃ©gias</div><div style="font-size:9px;color:${sC(b.signal||"NEUTRAL")}">Conf: ${(b.confidence||0).toFixed(0)}%</div>${b.rr_ratio>0?`<div style="font-size:9px;color:#8899AA">R:R 1:${b.rr_ratio}</div>`:""}`:
        `<div style="font-size:8px;color:#FF4455;margin-top:4px">Bot offline</div>`}
      </div>
    </div>
    ${p.sp?.length>0?`<div style="margin-top:10px"><div class="lbl">PREÃ‡O 7 DIAS</div><canvas id="spk" height="50" style="width:100%"></canvas></div>`:""}`;

  // Signal card
  const sc=document.getElementById("sc");
  if(BON&&b.signal&&b.signal!=="NEUTRAL"&&b.stop_loss>0){
    sc.style.display="block";sc.style.border=`1px solid ${sC(b.signal)}28`;
    sc.innerHTML=`<div style="font-size:9px;color:${sC(b.signal)};margin-bottom:10px;letter-spacing:1px;font-weight:700">âš¡ PARÃ‚METROS â€” ${b.signal} Â· R:R 1:${b.rr_ratio}</div>
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:10px">
      ${[["Entrada",fP(b.entry),"#8899AA"],["Stop Loss",fP(b.stop_loss),"#FF4455"],["TP1 40%",fP(b.tp1),"#00CC66"],["TP2 30%",fP(b.tp2),"#00EE77"],["TP3 30%",fP(b.tp3),"#00FF88"]].map(([k,v,c])=>`<div style="text-align:center;padding:8px;background:#020c18;border-radius:6px;border:1px solid #071422"><div style="font-size:7px;color:#2a4060;margin-bottom:3px">${k}</div><div style="font-size:10px;font-weight:700;color:${c};font-family:monospace">${v}</div></div>`).join("")}
    </div>
    <div style="display:flex;flex-wrap:wrap;gap:4px">${(b.reasons||[]).map(r=>`<span style="font-size:9px;color:#8899AA;background:#071422;padding:2px 8px;border-radius:3px">âœ“ ${r}</span>`).join("")}</div>`;
  } else { sc.style.display="none"; }

  // Sparkline
  if(p.sp?.length>0){setTimeout(()=>{
    const cv=document.getElementById("spk");if(!cv)return;cv.width=cv.offsetWidth;
    const ctx=cv.getContext("2d"),d=p.sp,mn=Math.min(...d),mx=Math.max(...d),w=cv.width,h=50,up=(p.c7||0)>=0;
    ctx.clearRect(0,0,w,h);
    const gr=ctx.createLinearGradient(0,0,0,h);gr.addColorStop(0,up?"rgba(0,255,136,.3)":"rgba(255,68,85,.3)");gr.addColorStop(1,"rgba(0,0,0,0)");
    ctx.beginPath();d.forEach((v,i)=>{const x=(i/(d.length-1))*w,y=h-((v-mn)/(mx-mn||1))*(h-4)-2;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
    ctx.strokeStyle=up?"#00FF88":"#FF4455";ctx.lineWidth=1.5;ctx.stroke();
    ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();ctx.fillStyle=gr;ctx.fill();
  },50);}
}

// â”€â”€ BAR CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RBC(){
  const cv=document.getElementById("bc");if(!cv||!Object.keys(P).length)return;
  cv.width=cv.offsetWidth||500;
  const ctx=cv.getContext("2d"),data=SYM.map(s=>({s,v:P[s]?.c24||0})),mA=Math.max(...data.map(d=>Math.abs(d.v)),.1),w=cv.width,h=120,bw=(w-20)/data.length-4;
  ctx.clearRect(0,0,w,h);
  const zY=h/2;ctx.strokeStyle="#1a2e42";ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(10,zY);ctx.lineTo(w-10,zY);ctx.stroke();
  data.forEach((d,i)=>{
    const x=10+i*((w-20)/data.length),bh=(Math.abs(d.v)/mA)*(h/2-16),y=d.v>=0?zY-bh:zY;
    ctx.fillStyle=d.v>=0?"#00FF8880":"#FF445580";
    ctx.beginPath();ctx.roundRect?ctx.roundRect(x,y,bw,bh,[3,3,0,0]):ctx.rect(x,y,bw,bh);ctx.fill();
    ctx.fillStyle="#2a4060";ctx.font="8px monospace";ctx.textAlign="center";ctx.fillText(d.s,x+bw/2,h-2);
    ctx.fillStyle=d.v>=0?"#00FF8888":"#FF445588";ctx.font="7px monospace";
    ctx.fillText((d.v>=0?"+":"")+d.v.toFixed(1)+"%",x+bw/2,d.v>=0?y-3:y+bh+9);
  });
}

// â”€â”€ MARKET GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RMG(){
  const p=P[SC]||{},v=fg.value,fc=v<25?"#FF4455":v<45?"#FF8800":v>75?"#FF4455":v>55?"#00FF88":"#FFB800";
  document.getElementById("mg").innerHTML=[
    ["Medo e GanÃ¢ncia",`<span style="color:${fc}">${fg.value}</span> <span style="font-size:9px;color:#4a6060">${fg.classification}</span>`],
    ["Vol 24h "+SC,`<span class="gray">${fB(p.vol)}</span>`],
    ["Cap. Mercado "+SC,`<span class="gray">${fB(p.mc)}</span>`],
  ].map(([k,v])=>`<div class="cdark"><div class="lbl">${k}</div><div style="font-size:11px">${v}</div></div>`).join("");
}

// â”€â”€ NEWS SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RNS(){
  const f=NF==="ALL"?AN:AN.filter(n=>n.coin===NF||n.coin==="ALL");
  const e=document.getElementById("nsb");
  if(!AN.length){e.innerHTML=`<div style="padding:20px;text-align:center;color:#2a4060"><span class="sp">âŸ³</span></div>`;return;}
  e.innerHTML=f.slice(0,25).map(n=>`
    <div class="ni${n.brk?" nb":""}" onclick="window.open('${n.url}','_blank')">
      ${n.brk?`<div style="font-size:8px;color:#FF4455;font-weight:700;margin-bottom:2px;letter-spacing:1px">âš¡ URGENTE</div>`:""}
      <div style="font-size:10px;color:${n.brk?"#FFAAAA":"#9aaabb"};line-height:1.4">${n.title}</div>
      <div style="display:flex;gap:5px;margin-top:3px;flex-wrap:wrap;align-items:center">
        <span style="font-size:8px;color:#2a3a50">${n.source}</span>
        <span style="font-size:8px;color:#1a2e42">${n.time}</span>
        ${tg((n.imp>0?"+":"")+n.imp,n.imp>0?"#00FF88":"#FF4455",(n.imp>0?"#00FF88":"#FF4455")+"15")}
      </div>
    </div>`).join("");
}

// â”€â”€ SINAIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RSG(){
  if(!BON){document.getElementById("sof").style.display="block";document.getElementById("son").style.display="none";return;}
  document.getElementById("sof").style.display="none";document.getElementById("son").style.display="block";
  const sigs=Object.values(BS),ls=sigs.filter(s=>s.signal==="LONG"),ss=sigs.filter(s=>s.signal==="SHORT");
  document.getElementById("sstats").innerHTML=[
    ["LONGs",ls.length,"#00FF88"],["SHORTs",ss.length,"#FF4455"],
    ["Neutros",sigs.filter(s=>!s.signal||s.signal==="NEUTRAL").length,"#8899AA"],
    ["Ciclo",BH?.cycle||"â€”","#00AAFF"],
  ].map(([k,v,c])=>`<div class="card"><div class="lbl">${k}</div><div style="font-size:22px;font-weight:700;color:${c};font-family:monospace">${v}</div></div>`).join("");
  document.getElementById("stbl").innerHTML=`<div class="tr th" style="grid-template-columns:60px 58px 40px 105px 50px 85px 85px 85px 1fr;gap:6px">
    <span>Ativo</span><span>Sinal</span><span>TF</span><span>EstratÃ©gia</span><span>Conf.</span><span>Entrada</span><span>Stop</span><span>TP1</span><span>Motivos</span>
  </div>` + SYM.map(sym=>{
    const b=BS[sym]||{},p=P[sym]||{},c=CLR[sym],hs=b.signal&&b.signal!=="NEUTRAL";
    return `<div class="tr" style="grid-template-columns:60px 58px 40px 105px 50px 85px 85px 85px 1fr;gap:6px;background:${b.signal==="LONG"?"#00FF8806":b.signal==="SHORT"?"#FF445506":"transparent"}">
      <div style="display:flex;align-items:center;gap:5px"><div style="width:6px;height:6px;border-radius:50%;background:${c}"></div><span style="font-weight:700;color:#D0E0F0">${sym}</span></div>
      ${tg(b.signal||"â€”",sC(b.signal||"NEUTRAL"),sBg(b.signal||"NEUTRAL"))}
      <span class="gray" style="font-weight:700">${b.timeframe||"â€”"}</span>
      <span class="blue" style="font-size:9px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${b.best_strategy||"â€”"}</span>
      <span style="color:${sC(b.signal||"NEUTRAL")};font-weight:700">${(b.confidence||0).toFixed(0)}%</span>
      <span class="gray">${hs?fP(b.entry):"â€”"}</span>
      <span class="red">${hs?fP(b.stop_loss):"â€”"}</span>
      <span class="green">${hs?fP(b.tp1):"â€”"}</span>
      <span style="font-size:8px;color:#4a6080">${(b.reasons||[]).slice(0,2).join(", ")||"â€”"}</span>
    </div>`;
  }).join("");
}

// â”€â”€ POSIÃ‡Ã•ES COM P&L AO VIVO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RPS(){
  const bl=BM?.balance||10000;
  document.getElementById("pstats").innerHTML=[
    ["Saldo Paper","$"+bl.toLocaleString("en",{maximumFractionDigits:2}),"#00FF88"],
    ["PosiÃ§Ãµes Abertas",BP.length,"#00AAFF"],
    ["Modo",(BM?.mode||"dry").toUpperCase(),"#FFB800"],
  ].map(([k,v,c])=>`<div class="card"><div class="lbl">${k}</div><div style="font-size:18px;font-weight:700;color:${c};font-family:monospace">${v}</div></div>`).join("");
  
  const e=document.getElementById("pcnt");
  if(!BON){e.innerHTML=`<div style="text-align:center;padding:50px;color:#2a4060;font-size:11px">Bot offline â€” sem dados de posiÃ§Ãµes.</div>`;return;}
  if(!BP.length){e.innerHTML=`<div style="text-align:center;padding:50px;color:#2a4060;line-height:2;font-size:11px"><div style="font-size:36px;margin-bottom:12px">ğŸ“Š</div>Nenhuma posiÃ§Ã£o aberta no momento.</div>`;return;}

  e.innerHTML=`<div class="card" style="overflow:hidden"><div class="tr th" style="grid-template-columns:60px 60px 80px 80px 70px 60px 80px 1fr;gap:8px"><span>Ativo</span><span>Lado</span><span>Entrada</span><span>Atual</span><span>P&L ($)</span><span>Live %</span><span>TP1</span><span>Abertura</span></div>
  ${BP.map(p=>{
    const sym = p.symbol?.replace("/USDT","");
    const cp = P[sym]?.price || p.entry; // PreÃ§o ao vivo
    const isLong = p.side==="Buy" || p.side==="LONG";
    // CÃ¡lculo do Percentual ao Vivo
    const pnl_pct = isLong ? ((cp - p.entry)/p.entry)*100 : ((p.entry - cp)/p.entry)*100;
    const pnl_usd = (p.size||(100/p.entry)) * p.entry * (pnl_pct/100); 

    return `<div class="tr" style="grid-template-columns:60px 60px 80px 80px 70px 60px 80px 1fr;gap:8px;background:${pnl_pct>=0?"#00FF880A":"#FF44550A"}">
      <span style="font-weight:700;color:#D0E0F0">${sym}</span>
      ${tg(isLong?"LONG":"SHORT",sC(isLong?"LONG":"SHORT"))}
      <span class="gray">${fP(p.entry)}</span>
      <span style="color:#E8F4FF">${fP(cp)}</span>
      <span style="color:${gc(pnl_usd)};font-weight:700">$${pnl_usd.toFixed(2)}</span>
      <span style="color:${gc(pnl_pct)};font-weight:700">${pc(pnl_pct)}</span>
      <span class="green">${fP(p.tp1)}</span>
      <span style="font-size:8px;color:#2a4060">${p.opened_at||"â€”"}</span>
    </div>`
  }).join("")}</div>`;
}

// â”€â”€ FULL NEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RFN(){
  const v=fg.value,fc=v<40?"#FF4455":v>60?"#00FF88":"#FFB800";
  document.getElementById("nstats").innerHTML=[
    [`F&G: ${fg.value}`,fg.classification,fc],["URGENTES",AN.filter(n=>n.brk).length+" alertas","#FF4455"],
    ["Otimistas",AN.filter(n=>n.imp>=4).length+" notÃ­cias","#00FF88"],["Pessimistas",AN.filter(n=>n.imp<=-4).length+" notÃ­cias","#FF4455"],
  ].map(([k,v,c])=>`<div class="card"><div class="lbl">${k}</div><div style="font-size:14px;font-weight:700;color:${c};font-family:monospace">${v}</div></div>`).join("");
  const f=NF2==="ALL"?AN:AN.filter(n=>n.coin===NF2||n.coin==="ALL");
  document.getElementById("nlbl").textContent=(AN.length||0)+" NOTÃCIAS AO VIVO â€” CryptoCompare";
  document.getElementById("nfl").innerHTML=f.map(n=>`
    <div class="ni${n.brk?" nb":""}" onclick="window.open('${n.url}','_blank')">
      ${n.brk?`<span style="font-size:8px;color:#FF4455;font-weight:700;letter-spacing:1px">âš¡ URGENTE </span>`:""}
      <div style="font-size:11px;color:${n.brk?"#FFAAAA":"#C0D0E0"};line-height:1.4;margin-bottom:5px">${n.title}</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <span style="font-size:9px;color:#3a5070">${n.source}</span>
        <span style="font-size:9px;color:#1a2e42">${n.time}</span>
        ${tg(n.coin,CLR[n.coin]||"#8899AA")}
        ${tg((n.imp>0?"+":"")+n.imp,n.imp>0?"#00FF88":"#FF4455",(n.imp>0?"#00FF88":"#FF4455")+"15")}
        ${tg(n.cat,"#4a6080")}
        <span style="font-size:8px;color:#00AAFF55">â†— ler</span>
      </div>
    </div>`).join("");
}

// â”€â”€ TRADES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RTR(){
  const st=BT.stats||{};
  document.getElementById("tstats").innerHTML=[
    ["Lucro Total","$"+(st.total_pnl||0).toFixed(2),(st.total_pnl||0)>=0?"#00FF88":"#FF4455"],
    ["Taxa de Acerto",(st.win_rate||0).toFixed(1)+"%","#00AAFF"],
    ["VitÃ³rias / Derrotas",(st.wins||0)+" / "+(st.losses||0),"#FFB800"],
    ["MÃ©dia de Lucro","$"+(st.avg_win||0).toFixed(2),"#00FF88"],
  ].map(([k,v,c])=>`<div class="card"><div class="lbl">${k}</div><div style="font-size:16px;font-weight:700;color:${c};font-family:monospace">${v}</div></div>`).join("");
  const tr=BT.trades||[],e=document.getElementById("tcnt");
  if(!tr.length){e.innerHTML=`<div style="text-align:center;padding:50px;color:#2a4060;font-size:11px">${BON?"Nenhum trade fechado ainda.":"Bot offline."}</div>`;return;}
  e.innerHTML=`<div class="card" style="overflow:hidden"><div class="tr th" style="grid-template-columns:60px 65px 90px 90px 80px 65px 1fr;gap:8px"><span>Ativo</span><span>Lado</span><span>Entrada</span><span>SaÃ­da</span><span>P&L</span><span>%</span><span>Data</span></div>
  ${tr.map(t=>`<div class="tr" style="grid-template-columns:60px 65px 90px 90px 80px 65px 1fr;gap:8px;background:${(t.pnl||0)>=0?"#00FF8805":"#FF445505"}">
    <span style="font-weight:700;color:#D0E0F0">${t.symbol?.replace("/USDT","")}</span>
    ${tg(t.side==="Buy"?"LONG":"SHORT",sC(t.side==="Buy"?"LONG":"SHORT"))}
    <span class="gray">${fP(t.entry)}</span><span class="gray">${fP(t.exit_price)}</span>
    <span style="color:${gc(t.pnl||0)};font-weight:700">$${(t.pnl||0).toFixed(2)}</span>
    <span style="color:${gc(t.pnl_pct||0)}">${pc(t.pnl_pct||0)}</span>
    <span style="font-size:8px;color:#2a4060">${t.closed_at||"â€”"}</span>
  </div>`).join("")}</div>`;
}

// â”€â”€ LOGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RLG(){
  document.getElementById("lst").textContent=BON?"LIVE Â· atualiza a cada 15s":"Bot offline";
  const e=document.getElementById("lcnt");
  if(!BL.length){e.innerHTML=`<div style="text-align:center;padding:30px;color:#2a4060">${BON?"Aguardando eventos...":"Bot offline."}</div>`;return;}
  e.innerHTML=BL.map(l=>`<div style="font-family:monospace;font-size:10px;padding:3px 0;border-bottom:1px solid #071422;color:${l.type==="BUY"?"#00FF88":l.type==="SELL"?"#FF4455":l.type==="ERROR"?"#FF8800":"#2a4060"}">
    <span style="color:#1a2e42;margin-right:8px">${l.time}</span><span style="margin-right:8px;font-weight:700">[${l.type}]</span>${l.msg}
  </div>`).join("");
}

// â”€â”€ TICKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RTK(){
  if(!Object.keys(P).length)return;
  document.getElementById("tki").innerHTML=[...SYM,...SYM].map(s=>{
    const p=P[s]||{},b=BS[s]||{},chg=p.c24||0;
    return `<span style="font-size:10px;font-family:monospace;color:${gc(chg)}"><span style="color:#2a4060;margin-right:4px">${s}</span>${p.price?fP(p.price):"â€”"}<span style="margin-left:4px">${chg>=0?"â–²":"â–¼"}${Math.abs(chg).toFixed(2)}%</span>${b.signal&&b.signal!=="NEUTRAL"?`<span style="margin-left:4px;color:${sC(b.signal)};font-size:8px">â—†${b.signal}</span>`:""}</span>`;
  }).join("");
}

// â”€â”€ PRICE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RPT(){
  document.getElementById("ptbl").innerHTML=SYM.map((s,i)=>{
    const p=P[s]||{},c=CLR[s];
    return `<div class="tr" style="grid-template-columns:30px 100px 110px 70px 75px 75px 90px 90px 75px;gap:8px;cursor:pointer;background:${SC===s?"#0a1e3522":"transparent"}" onclick="SC='${s}';ST('dash');RA()">
      <span style="color:#1a2e42">${i+1}</span>
      <div style="display:flex;align-items:center;gap:6px"><div style="width:8px;height:8px;border-radius:50%;background:${c}"></div><span style="font-weight:700;color:#D0E0F0">${s}</span></div>
      <span style="font-weight:700;color:#E8F4FF;font-family:monospace">${p.price?fP(p.price):"â€”"}</span>
      <span style="color:${gc(p.c1||0)}">${pc(p.c1||0)}</span>
      <span style="color:${gc(p.c24||0)};font-weight:700">${pc(p.c24||0)}</span>
      <span style="color:${gc(p.c7||0)}">${pc(p.c7||0)}</span>
      <span class="gray" style="font-family:monospace">${fB(p.vol)}</span>
      <span class="gray" style="font-family:monospace">${fB(p.mc)}</span>
      <span class="red" style="font-size:9px">${p.athC?p.athC.toFixed(1)+"%":"â€”"}</span>
    </div>`;
  }).join("");
}

// â”€â”€ NEWS FILTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SNF(f){NF=f;document.querySelectorAll(".nfb").forEach(b=>{const a=b.dataset.f===f;b.style.background=a?"#00FF8818":"none";b.style.borderColor=a?"#00FF8844":"#071422";b.style.color=a?"#00FF88":"#2a4060";});RNS();}
function SNF2(f){NF2=f;document.querySelectorAll(".nf2").forEach(b=>{const a=b.textContent.trim()===f;b.style.background=a?"#00FF8818":"none";b.style.borderColor=a?"#00FF8844":"#071422";b.style.color=a?"#00FF88":"#2a4060";});RFN();}

// â”€â”€ RESUMO NO DASHBOARD PRINCIPAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RDashExtras() {
  const dp = document.getElementById("dash-pos");
  if(BP && BP.length > 0) {
    dp.style.display = "block";
    dp.innerHTML = `<div class="card"><div class="lbl" style="margin-bottom:10px;color:#00AAFF">âš¡ POSIÃ‡Ã•ES AO VIVO</div>
    <div style="display:grid;gap:6px">
    ${BP.map(p=>{
       const sym = p.symbol?.replace("/USDT","");
       const cp = P[sym]?.price || p.entry;
       const isLong = p.side==="Buy" || p.side==="LONG";
       const pnl_pct = isLong ? ((cp - p.entry)/p.entry)*100 : ((p.entry - cp)/p.entry)*100;
       return `<div style="display:flex;justify-content:space-between;background:#020c18;padding:8px 12px;border-radius:6px;border:1px solid ${pnl_pct>=0?'#00FF8833':'#FF445533'}">
          <div style="display:flex;gap:8px;align-items:center"><span style="font-weight:700;color:#D0E0F0">${sym}</span>${tg(isLong?"LONG":"SHORT",sC(isLong?"LONG":"SHORT"))}</div>
          <div style="display:flex;gap:12px;align-items:center">
            <span style="font-size:10px;color:#8899AA">Entrada: ${fP(p.entry)}</span>
            <span style="font-size:12px;font-weight:700;color:${gc(pnl_pct)}">${pnl_pct>=0?'ğŸš€':'ğŸ”»'} ${pc(pnl_pct)}</span>
          </div>
       </div>`;
    }).join("")}</div></div>`;
  } else { dp.style.display = "none"; }

  const dt = document.getElementById("dash-trades");
  if(BT && BT.trades && BT.trades.length > 0) {
    dt.style.display = "block";
    dt.innerHTML = `<div class="card"><div class="lbl" style="margin-bottom:10px;color:#FFB800">ğŸ† ÃšLTIMOS TRADES ENCERRADOS</div>
    <div style="display:grid;gap:6px">
    ${BT.trades.slice(0, 3).map(t=>{
       const sym = t.symbol?.replace("/USDT","");
       const isLong = t.side==="Buy" || t.side==="LONG";
       return `<div style="display:flex;justify-content:space-between;background:#020c18;padding:8px 12px;border-radius:6px;border:1px solid #071422">
          <div style="display:flex;gap:8px;align-items:center"><span style="font-weight:700;color:#D0E0F0">${sym}</span>${tg(isLong?"LONG":"SHORT",sC(isLong?"LONG":"SHORT"), (t.pnl>=0?"#00FF8815":"#FF445515"))}</div>
          <div style="display:flex;gap:12px;align-items:center">
            <span style="font-size:10px;color:#8899AA">SaÃ­da: ${fP(t.exit_price)}</span>
            <span style="font-size:12px;font-weight:700;color:${gc(t.pnl)}">${t.pnl>=0?'+':''}$${(t.pnl||0).toFixed(2)} (${pc(t.pnl_pct||0)})</span>
          </div>
       </div>`;
    }).join("")}</div></div>`;
  } else { dt.style.display = "none"; }
}

// â”€â”€ P&L AO VIVO GLOBAL NO CABEÃ‡ALHO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RLivePnL() {
  const box = document.getElementById("live-pnl-box");
  const lbl = document.getElementById("live-pnl-lbl");
  const val = document.getElementById("live-pnl-val");
  
  if(!BON || !BP || BP.length === 0) {
    val.innerHTML = `<span style="color:#FFB800">$0.00 <span style="font-size:10px">(0.00%)</span></span>`;
    box.style.borderColor = "#FFB800";
    box.style.background = "#FFB80015";
    box.style.boxShadow = "0 0 10px #FFB80040";
    lbl.style.color = "#FFB800";
    return;
  }
  
  let total_pnl_usd = 0;
  const balance = BM?.balance || 10000;
  
  BP.forEach(p => {
    const sym = p.symbol?.replace("/USDT","");
    const cp = P[sym]?.price || p.entry;
    const isLong = p.side==="Buy" || p.side==="LONG";
    const pnl_pct = isLong ? ((cp - p.entry)/p.entry)*100 : ((p.entry - cp)/p.entry)*100;
    const pnl_usd = (p.size||(100/p.entry)) * p.entry * (pnl_pct/100); 
    total_pnl_usd += pnl_usd;
  });
  
  const total_pnl_pct = (total_pnl_usd / balance) * 100;
  const c = total_pnl_usd >= 0 ? "#00FF88" : "#FF4455";
  const s = total_pnl_usd >= 0 ? "+" : "";
  
  val.innerHTML = `<span style="color:${c}">${s}$${Math.abs(total_pnl_usd).toFixed(2)} <span style="font-size:10px">(${s}${total_pnl_pct.toFixed(2)}%)</span></span>`;
  box.style.borderColor = c;
  box.style.background = c + "15";
  box.style.boxShadow = `0 0 12px ${c}40`;
  lbl.style.color = c;
}

// â”€â”€ RENDER ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function RA(){RCL();RMC();RBC();RMG();RNS();RTK();RPT();RDashExtras();RLivePnL();}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FP();FFG();FN();FB();
setInterval(FP,30000);setInterval(FFG,300000);setInterval(FN,120000);setInterval(FB,15000);
setInterval(()=>{document.getElementById("ftm").textContent=new Date().toLocaleTimeString("pt-BR");},1000);
window.addEventListener("resize",RBC);
</script>
</body>
</html>
